{% extends "base.html" %}
{% load custom_filters %}
{% block body_class %}more-read-page{% endblock %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/your-style.css' %}">

{% block content %}
<h2 style="text-align: center; margin-top: 10px;">ã‚‚ã£ã¨ã‚ˆã‚“ã§</h2>

<!-- ğŸ”½ å­ã©ã‚‚é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ -->
<div class="child-selector">
  <label for="child">æœ¬æ£šã‚’é¸æŠ:</label>
  <select id="child" name="child_id" onchange="location.href='?child_id=' + this.value;">
    <option value="" {% if not selected_child_id %}selected{% endif %}>å…±é€šã®æœ¬æ£š</option>
    {% for child in children %}
      <option value="{{ child.id }}" {% if child.id|stringformat:"s" == selected_child_id %}selected{% endif %}>
        {{ child.name }}
      </option>
    {% endfor %}
  </select>
</div>

<!-- ğŸ“š çµµæœ¬ã‚°ãƒªãƒƒãƒ‰ï¼ˆ3åˆ—Ã—2æ®µï¼‰ -->
<div class="book-list">
  <div class="book-container more-read">
    {% for book in books %}
      <div class="book-item with-tooltip">
        <a href="{% url 'book_detail' book.id %}">
          <img class="book-image" src="{{ book.image.url }}" alt="{{ book.title }}">
          
          <!-- âœ… DEBUG è¡¨ç¤º -->
          <div style="font-size:12px; color:red; text-align:left;">
            <strong>book.id:</strong> {{ book.id }}<br>
            <strong>tooltip_counts[book.id]:</strong> {{ tooltip_counts|get_item:book.id }}
          </div>

          {% if not selected_child_id %}
            <span class="tooltip-text">
              {% with tooltip_counts|get_item:book.id as count_dict %}
                {% if count_dict %}
                  {% for name, count in count_dict.items %}
                    {{ name }}ï¼š{{ count }}å›<br>
                  {% endfor %}
                {% else %}
                  ãƒ‡ãƒ¼ã‚¿ãªã—
                {% endif %}
              {% endwith %}

            </span>
          
          {% else %}
            <span class="tooltip-text">
              {{ read_counts|get_item:book.id|default:0 }} å›ã‚ˆã‚“ã 
            </span>
          {% endif %}
        </a>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
