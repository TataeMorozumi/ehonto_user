{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="book-detail-container">

  <!-- âœ… å·¦å´ï¼ˆè¡¨ç´™ç”»åƒãƒ»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»è‘—è€…ãƒ»ç™»éŒ²æ—¥ï¼‰ -->
  <div class="book-info">
    <img src="{{ book.image.url }}" alt="{{ book.title }}" class="book-cover">
    <h2>{{ book.title }}</h2>
    <p>è‘—è€…: {{ book.author }}</p>
    <p>ç™»éŒ²æ—¥: {{ book.created_at|date:"Yå¹´mæœˆdæ—¥" }}</p>

    <!-- âœ… å‰Šé™¤ãƒœã‚¿ãƒ³ -->
    <form method="POST" action="{% url 'delete_book' book.id %}" onsubmit="return confirmDelete();">
        {% csrf_token %}
        <button type="submit" class="delete-button">å‰Šé™¤</button>
    </form>
</div>

<!-- âœ… å³å´ï¼ˆç™»éŒ²ã—ãŸå­ã©ã‚‚ã®æƒ…å ± + ãƒ¡ãƒ¢å…¥åŠ›ï¼‰ -->
<div class="book-owners">   
    {% for child in book.children.all %}
        <div class="child-box">
            <div class="child-info">
                <span class="child-icon">ğŸ‘¦</span>
                <span class="child-name">{{ child.name }}</span>
            </div>
            
            <!-- âœ… ãƒ¡ãƒ¢å…¥åŠ›æ¬„ -->
            <textarea class="memo-box" id="memo-{{ child.id }}" placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›..."></textarea>

            <!-- âœ… ä¿å­˜ãƒœã‚¿ãƒ³ -->
            <button onclick="saveMemo({{ child.id }})" class="memo-save-btn">ä¿å­˜</button>
        </div>
    {% endfor %}
</div>

{% endblock %}

{% block scripts %}
<script>
function saveMemo(childId) {
    let memoContent = document.getElementById("memo-" + childId).value;
    console.log("ä¿å­˜ã•ã‚ŒãŸãƒ¡ãƒ¢: " + memoContent);

    // âœ… ãƒ¡ãƒ¢ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®Ajaxãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    fetch('/save_memo/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'  // âœ… CSRFå¯¾ç­–
        },
        body: JSON.stringify({ child_id: childId, memo: memoContent })
    })
    .then(response => response.json())
    .then(data => {
        alert("ãƒ¡ãƒ¢ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼");
    })
    .catch(error => console.error("ãƒ¡ãƒ¢ä¿å­˜ã‚¨ãƒ©ãƒ¼:", error));
}
</script>
{% endblock %}   